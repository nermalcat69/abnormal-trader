import{_ as ne}from"./NIconButton.vue.61149d03.js";import{_ as oe}from"./NSelect.vue.90e01b18.js";import{_ as ae}from"./NTextInput.vue.f5b2276f.js";import{a as se,av as re,W as le,r as I,z as S,a9 as A,ag as P,a7 as ue,R as ie,a6 as de,e as ce,x as p,u as n,c as _,w as u,aw as z,o as r,f as l,i as d,h as c,p as q,D as v,F as b,K as U,l as i,s as E,aq as j,q as F,a2 as me,aG as pe,aP as _e,aB as fe,ai as ye,y as ve,k as ge,ab as he}from"./entry.2a062301.js";import{_ as ke}from"./NLink.vue.5e75761d.js";import{_ as xe}from"./NPanelGrids.c52bd29c.js";import{_ as be}from"./PanelLeftRight.vue.8adf1a04.js";import{_ as we}from"./FilepathItem.vue.1374ae6e.js";import{U as Ke}from"./json-editor-vue.c66387bd.js";import"./editor.4c6382c7.js";const Ce={class:"h-[48px] flex items-center justify-between gap1 px-3"},Ve={class:"w-full text-sm"},Ne=["value"],$e=l("div",{"x-divider":""},null,-1),Ie={key:0,"h-full":"","of-hidden":"",flex:"~ col"},Se={border:"b base",class:"h-[49px] flex flex-none items-center justify-between px-4 text-sm"},qe={class:"flex items-center gap-4"},Ue={key:1},je=["onKeyup"],Be=l("br",null,null,-1),Le={key:0,op50:""},De={key:1},Me=l("code",null,"nitro.storage",-1),Re=l("br",null,null,-1),Ae={"font-bold":""},Pe=l("br",null,null,-1),ze={"text-sm":""},Ee=l("br",null,null,-1),tt=se({__name:"storage",async setup(Fe){let m,g;const T=re(),h=le(),k=I(""),y=I(""),a=S({get(){return A().query?.storage},set(t){h.replace({query:{storage:t}})}}),e=I(),x=S(()=>A().query?.key),{data:w}=([m,g]=P(()=>z("storageMounts",()=>p.getStorageMounts())),m=await m,g(),m),{data:K,refresh:B}=([m,g]=P(async()=>z("storageKeys",async()=>a.value?await p.getStorageKeys(a.value):[])),m=await m,g(),m),G=T.hook("storage:key:update",async(t,s)=>{if(!(!a.value||t.split(":")[0]!==a.value)&&(await B(),x.value===t)){if(s==="remove")return h.replace({query:{storage:a.value}});await V(x.value)}});ue(G),ie(a,B),de(async()=>{if(!x.value){e.value=null;return}V(x.value)}),ce("keydown",t=>{t.key==="s"&&(t.ctrlKey||t.metaKey)&&(N(),t.preventDefault())});function C(t){return t.replace(`${a.value}:`,"")}const W=S(()=>K.value?K.value.filter(t=>t.includes(k.value)):[]);async function V(t){const s=await p.getStorageItem(t);e.value={key:t,updatedKey:C(t),editingKey:!1,content:s,updatedContent:s}}async function O(){if(!y.value||!a.value)return;const t=`${a.value}:${y.value}`;K.value?.includes(t)||await p.setStorageItem(t,""),h.replace({query:{storage:a.value,key:t}}),y.value=""}async function N(){e.value&&(await p.setStorageItem(e.value.key,e.value.updatedContent),await V(e.value.key))}async function H(){!e.value||!a.value||(await p.removeStorageItem(e.value.key),e.value=null)}async function J(){if(!e.value||!a.value)return;const t=`${a.value}:${e.value.updatedKey}`;await p.setStorageItem(t,e.value.updatedContent),await p.removeStorageItem(e.value.key),h.replace({query:{storage:a.value,key:t}})}return(t,s)=>{const Q=ne,X=oe,$=ae,Y=ye,Z=ve,L=ge,D=ke,M=he,R=xe,ee=be,te=we;return n(a)?(r(),_(ee,{key:0,"storage-key":"tab-storage"},{left:u(()=>[l("div",Ce,[d(Q,{icon:"carbon-chevron-left","ml--1":"",onClick:s[0]||(s[0]=o=>a.value="")}),l("div",Ve,[d(X,{modelValue:n(a),"onUpdate:modelValue":s[1]||(s[1]=o=>U(a)?a.value=o:null),n:"primary",icon:"carbon-data-base"},{default:u(()=>[(r(!0),c(b,null,q(n(w),(o,f)=>(r(),c("option",{key:f,value:f},v(f),9,Ne))),128))]),_:1},8,["modelValue"])])]),d($,{modelValue:n(k),"onUpdate:modelValue":s[2]||(s[2]=o=>U(k)?k.value=o:null),icon:"carbon-search",placeholder:"Search...",n:"primary sm",border:"y x-none base! rounded-0",class:"w-full py2 ring-0!"},null,8,["modelValue"]),(r(!0),c(b,null,q(n(W),o=>(r(),c(b,{key:o},[d(Y,{block:"",truncate:"",px2:"",py1:"","font-mono":"","text-sm":"",to:{query:{key:o,storage:n(a)}},class:E(o===n(e)?.key?"text-primary n-bg-active":"text-secondary hover:n-bg-hover")},{default:u(()=>[i(v(C(o)),1)]),_:2},1032,["to","class"]),$e],64))),128)),d($,{modelValue:n(y),"onUpdate:modelValue":s[3]||(s[3]=o=>U(y)?y.value=o:null),icon:"carbon-add",placeholder:"key",n:"sm",border:"t-none x-none base! rounded-0",class:"w-full py2 font-mono ring-0!",onKeyup:j(O,["enter"])},null,8,["modelValue","onKeyup"])]),right:u(()=>[n(e)?.key?(r(),c("div",Ie,[l("div",Se,[l("div",qe,[n(e).editingKey?(r(),_($,{key:0,modelValue:n(e).updatedKey,"onUpdate:modelValue":s[4]||(s[4]=o=>n(e).updatedKey=o),onKeyup:j(J,["enter"])},null,8,["modelValue","onKeyup"])):(r(),c("code",Ue,[i(v(C(n(e).key))+" ",1),d(Z,{icon:"carbon-edit",class:"cursor-pointer op50 hover:op100",onClick:s[5]||(s[5]=o=>n(e).editingKey=!0)})])),n(e).editingKey?F("",!0):(r(),_(L,{key:2,n:"green xs",disabled:n(e).content===n(e).updatedContent,class:E({"border-green":n(e).content!==n(e).updatedContent}),onClick:N},{default:u(()=>[i(" Save ")]),_:1},8,["disabled","class"]))]),l("div",null,[d(L,{n:"red xs",onClick:H},{default:u(()=>[i(" Delete ")]),_:1})])]),typeof n(e).content=="object"?(r(),_(n(Ke),me({key:0,modelValue:n(e).updatedContent,"onUpdate:modelValue":s[6]||(s[6]=o=>n(e).updatedContent=o),class:[[t.$colorMode.value==="dark"?"jse-theme-dark":"light"],"json-editor-vue h-full of-auto text-sm outline-none"]},t.$attrs,{mode:"text","navigation-bar":!1,indentation:2,"tab-size":2}),null,16,["modelValue","class"])):pe((r(),c("textarea",{key:1,"onUpdate:modelValue":s[7]||(s[7]=o=>n(e).updatedContent=o),placeholder:"Item value...",class:"h-full of-auto p-4 font-mono text-sm outline-none",onKeyup:j(fe(N,["ctrl"]),["enter"])},null,40,je)),[[_e,n(e).updatedContent]])])):(r(),_(R,{key:1},{default:u(()=>[d(M,{px6:"",py4:""},{default:u(()=>[i(" Select one key to start."),Be,i("Learn more about "),d(D,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:u(()=>[i(" Nitro storage ")]),_:1})]),_:1})]),_:1}))]),_:1})):(r(),_(R,{key:1},{default:u(()=>[Object.keys(n(w)).length?(r(),c("p",Le," Select one storage to start: ")):(r(),c("p",De,[i(" No custom storage defined in "),Me,i("."),Re,i(" Learn more about "),d(D,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:u(()=>[i(" Nitro storage ")]),_:1})])),(r(!0),c(b,null,q(n(w),(o,f)=>(r(),_(M,{key:f,"min-w-80":"","cursor-pointer":"","p-4":"","text-left":"",hover:"border-green",onClick:Te=>a.value=f},{default:u(()=>[l("span",Ae,v(f),1),Pe,l("span",ze,v(o.driver)+" driver",1),Ee,o.base?(r(),_(te,{key:0,"text-xs":"",filepath:o.base},null,8,["filepath"])):F("",!0)]),_:2},1032,["onClick"]))),128))]),_:1}))}}});export{tt as default};
